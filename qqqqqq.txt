---
- name: Deploy to GCP
  hosts: localhost
  gather_facts: false
  vars:
    gcp_project: "my-project"
  tasks:
    - name: Authenticate to GCP using AAP credential
      google.cloud.gcp_service_account:
        project: "{{ gcp_project }}"
        auth_kind: "serviceaccount"
        service_account_file: "{{ lookup('file', tower.filename.service_account_json) }}"
      register: gcp_auth

    - name: Create GCS Bucket
      google.cloud.gcp_storage_bucket:
        name: "my-secure-bucket"
        project: "{{ gcp_project }}"
        auth_kind: "serviceaccount"
        service_account_file: "{{ lookup('file', tower.filename.service_account_json) }}"
        state: present


gpt

- name: Create a GCP instance
  hosts: localhost
  gather_facts: no
  tasks:
    - name: Create an instance
      google.cloud.gcp_compute_instance:
        name: my-instance
        machine_type: n1-standard-1
        zone: us-central1-a
        project: my-project
        auth_kind: serviceaccount
        service_account_file: "{{ lookup('env', 'GCP_SERVICE_ACCOUNT_FILE') }}"
